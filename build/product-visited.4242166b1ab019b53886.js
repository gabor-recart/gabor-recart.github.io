/*! For license information please see product-visited.4242166b1ab019b53886.js.LICENSE.txt */
"use strict";(self.webpackChunk_ghostmonitor_gm_tracking_js=self.webpackChunk_ghostmonitor_gm_tracking_js||[]).push([["product-visited"],{"./app/main/modules/product-visited/product-visited.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"init\": () => (/* binding */ init)\n/* harmony export */ });\nfunction getProductHandle() {\n  return window.location.pathname.split('/products/')[1];\n}\nfunction getProductId() {\n  var _window$ShopifyAnalyt, _window$ShopifyAnalyt2, _window$ShopifyAnalyt3, _window$__st, _ref;\n  const shopifyAnalyticsProductId = (_window$ShopifyAnalyt = window.ShopifyAnalytics) === null || _window$ShopifyAnalyt === void 0 ? void 0 : (_window$ShopifyAnalyt2 = _window$ShopifyAnalyt.meta) === null || _window$ShopifyAnalyt2 === void 0 ? void 0 : (_window$ShopifyAnalyt3 = _window$ShopifyAnalyt2.product) === null || _window$ShopifyAnalyt3 === void 0 ? void 0 : _window$ShopifyAnalyt3.id;\n  const stProductId = (_window$__st = window.__st) === null || _window$__st === void 0 ? void 0 : _window$__st.rid;\n  return (_ref = shopifyAnalyticsProductId ?? stProductId) === null || _ref === void 0 ? void 0 : _ref.toString();\n}\nfunction getVariantId() {\n  var _window$ShopifyAnalyt4, _window$ShopifyAnalyt5;\n  const shopifyAnalyticsVariantId = (_window$ShopifyAnalyt4 = window.ShopifyAnalytics) === null || _window$ShopifyAnalyt4 === void 0 ? void 0 : (_window$ShopifyAnalyt5 = _window$ShopifyAnalyt4.meta) === null || _window$ShopifyAnalyt5 === void 0 ? void 0 : _window$ShopifyAnalyt5.selectedVariantId;\n  const searchParams = new URLSearchParams(window.location.search);\n  const variantIdSearchParam = searchParams.get('variant');\n  return shopifyAnalyticsVariantId ?? variantIdSearchParam;\n}\nfunction hasProductChanged(productHandle, productId, variantId) {\n  const lastProductHandle = window.sessionStorage.getItem('recart-last-product-handle');\n  const lastProductId = window.sessionStorage.getItem('recart-last-product-id');\n  const lastVariantId = window.sessionStorage.getItem('recart-last-variant-id');\n  return lastProductHandle !== productHandle || lastProductId !== productId || lastVariantId !== variantId;\n}\nfunction init(_ref2) {\n  let {\n    pixel\n  } = _ref2;\n  function sendProductVisited(productHandle, productId, variantId) {\n    pixel('product_visited', {\n      productHandle,\n      ...(productId && {\n        productId\n      }),\n      ...(variantId && {\n        variantId\n      })\n    });\n    window.sessionStorage.setItem('recart-last-product-handle', productHandle);\n    window.sessionStorage.setItem('recart-last-product-id', productId);\n    window.sessionStorage.setItem('recart-last-variant-id', variantId);\n  }\n  function checkProductPage() {\n    const productHandle = getProductHandle();\n    const productId = getProductId();\n    const variantId = getVariantId();\n    if (productHandle && hasProductChanged(productHandle, productId, variantId)) {\n      sendProductVisited(productHandle, productId, variantId);\n    }\n  }\n  function listenToUrlChanges() {\n    let previousUrl = '';\n    const observer = new MutationObserver(function (_) {\n      if (window.location.href !== previousUrl) {\n        if (previousUrl !== '') {\n          checkProductPage();\n        }\n        previousUrl = window.location.href;\n      }\n    });\n    const config = {\n      subtree: true,\n      childList: true\n    };\n    observer.observe(document, config);\n  }\n  checkProductPage();\n  listenToUrlChanges();\n}\n\n//# sourceURL=webpack://@ghostmonitor/gm-tracking-js/./app/main/modules/product-visited/product-visited.ts?")}}]);